<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥µç°¡é›²ç«¯æ‰“å¡</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <link rel="apple-touch-icon" href="icon.png">

    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Montserrat', "Microsoft JhengHei", sans-serif;
            color: white;
            margin: 0;
            overflow: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 30px;
            padding: 40px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            text-align: center;
            width: 85%;
            max-width: 420px;
        }

        #greeting { font-size: 1.2rem; font-weight: 300; letter-spacing: 2px; margin-bottom: 10px; }

        /* æ™‚é˜å„ªåŒ– */
        #time {
            font-size: 4.5rem;
            font-weight: 700;
            margin: 5px 0;
            letter-spacing: -2px;
        }

        #date {
            font-size: 1.1rem;
            opacity: 0.7;
            margin-bottom: 30px;
            font-weight: 300;
        }

        #inputArea input {
            padding: 15px;
            margin-bottom: 20px;
            border: none;
            border-radius: 12px;
            width: 100%;
            box-sizing: border-box;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            text-align: center;
            font-size: 1rem;
        }

        .check-in-btn {
            padding: 18px 30px;
            border: none;
            border-radius: 50px;
            background: #fff;
            color: #764ba2;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 100%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .check-in-btn:active { transform: scale(0.9); }
        .check-in-btn:hover { background: #f0f0f0; box-shadow: 0 15px 25px rgba(0,0,0,0.2); }

        #status { margin-top: 25px; font-size: 0.9rem; min-height: 1.5rem; font-weight: 300; }
    </style>
</head>
<body>

<div class="glass-card">
    <div id="greeting">READY TO WORK</div>
    <div id="time">00:00</div>
    <div id="date">Loading...</div>

    <div id="inputArea">
        <input type="text" id="username" placeholder="NAME">
    </div>
    
    <button class="check-in-btn" onclick="handleCheckIn()">SIGN IN</button>
    <div id="status"></div>
</div>

<script>

    // --- è®“ App è¨˜ä½ä½ æ˜¯èª°çš„é­”æ³• ---

// 1. å®šç¾©ä¸€å€‹è®Šæ•¸ä¾†å­˜åå­—
let currentUser = "";

// 2. ç¶²é ä¸€æ‰“é–‹å°±åŸ·è¡Œä»¥ä¸‹åˆ¤æ–·
function initializeUser() {
    const urlParams = new URLSearchParams(window.location.search);
    const nameFromUrl = urlParams.get('name');
    const savedName = localStorage.getItem('checkin_user_name');

    if (nameFromUrl) {
        // å¦‚æœç¶²å€æœ‰åå­—ï¼Œå„ªå…ˆä½¿ç”¨ä¸¦å­˜å…¥æ‰‹æ©Ÿè¨˜æ†¶é«”
        currentUser = nameFromUrl;
        localStorage.setItem('checkin_user_name', nameFromUrl);
    } else if (savedName) {
        // å¦‚æœç¶²å€æ²’åå­—ï¼Œä½†æ‰‹æ©Ÿä»¥å‰è¨˜éï¼Œå°±ç›´æ¥æ‹¿ä¾†ç”¨
        currentUser = savedName;
    }

    // 3. å¦‚æœæŠ“åˆ°äº†åå­—ï¼ˆä¸è«–æ˜¯ç¶²å€é‚„æ˜¯è¨˜æ†¶é«”ï¼‰ï¼Œå°±éš±è—è¼¸å…¥æ¡†
    if (currentUser) {
        document.getElementById('greeting').innerText = "HELLO, " + currentUser.toUpperCase();
        document.getElementById('inputArea').style.display = 'none';
    }
}

// åŸ·è¡Œåˆå§‹åŒ–
initializeUser();

// ä¿®æ”¹åŸæœ¬çš„ handleCheckIn å‡½æ•¸ç¬¬ä¸€è¡Œ
function handleCheckIn() {
    // å„ªå…ˆä½¿ç”¨æˆ‘å€‘æŠ“åˆ°çš„åå­—ï¼ŒçœŸçš„éƒ½æ²’æœ‰æ‰å»æŠ“è¼¸å…¥æ¡†
    const name = currentUser || document.getElementById('username').value;
    if (!name) return alert("Please enter your name");
    
    // ... ä»¥ä¸‹ç¶­æŒåŸæœ¬çš„å®šä½èˆ‡å‚³é€ä»£ç¢¼ ...
}
    // --- ã€è¨­å®šå€ã€‘ ---
    const TARGET_LAT = 25.08405444756406; // è¨˜å¾—æ”¹
    const TARGET_LNG = 121.54036143665965; // è¨˜å¾—æ”¹
    const MAX_DISTANCE = 0.2; 
    const WEB_APP_URL = "1RI6rQ8b8Wh3ovs5ElRkzplkMUKog9WcX93UxgyoFvaI"; 
    // ----------------

    function updateTime() {
        const now = new Date();
        // é è¨­ç‚ºä½¿ç”¨è€…æœ¬åœ°æ™‚é–“ï¼Œè§£æ±ºæ™‚å€å•é¡Œ
        const dateOptions = { year: 'numeric', month: 'short', day: 'numeric', weekday: 'short' };
        document.getElementById('date').innerText = now.toLocaleDateString('zh-TW', dateOptions);
        document.getElementById('time').innerText = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
    }
    setInterval(updateTime, 1000);
    updateTime();

    const urlParams = new URLSearchParams(window.location.search);
    const nameFromUrl = urlParams.get('name');
    if (nameFromUrl) {
        document.getElementById('greeting').innerText = "HELLO, " + nameFromUrl.toUpperCase();
        document.getElementById('inputArea').style.display = 'none';
    }

    function handleCheckIn() {
        const name = nameFromUrl || document.getElementById('username').value;
        if (!name) return alert("Please enter your name");

        document.getElementById('status').innerText = "ğŸ“ LOCATING...";

        navigator.geolocation.getCurrentPosition(function(position) {
            const distance = getDistance(position.coords.latitude, position.coords.longitude, TARGET_LAT, TARGET_LNG);

            if (distance <= MAX_DISTANCE) {
                // æˆåŠŸï¼šè§¸ç™¼äº”å½©ç¢ç´™æ•ˆæœï¼
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 },
                    colors: ['#ffffff', '#764ba2', '#667eea']
                });
                sendData(name, position.coords.latitude, position.coords.longitude);
            } else {
                document.getElementById('status').innerText = "âŒ TOO FAR (" + (distance * 1000).toFixed(0) + "m)";
            }
        }, function() {
            alert("Please enable GPS");
        });
    }

    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371;
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }

    function sendData(name, lat, lng) {
        document.getElementById('status').innerText = "ğŸš€ SENDING...";
        fetch(WEB_APP_URL, {
            method: "POST",
            mode: 'no-cors',
            body: JSON.stringify({
                name: name,
                time: new Date().toLocaleString('zh-TW', { hour12: false }),
                location: lat.toFixed(4) + "," + lng.toFixed(4)
            })
        }).then(() => {
            document.getElementById('status').innerText = "âœ… CHECKED IN SUCCESSFULLY!";
        });
    }
</script>

</body>
</html>




